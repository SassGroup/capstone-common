pipeline {
    agent any
    environment {
        //imagename = "vincentstrife/capstone-create-update"
        //registryCredential = "dockerVincentStrifeCred"
        // dockerImage = ''
        //devSystemAddress="devops@192.168.1.45"
        statusLoop=''
    }
    stages {
        stage('Kubectl delete deployment capstone-aerospike-kafka-deploy'){
            steps{
                script{
                    try {
                        sh 'kubectl delete deploy capstone-aerospike-kafka-deploy'
                    } catch (err) {
                        echo "Failed due to: ${err}"
                    }
                }
                sleep 20
            }
        }
        stage('Kubectl apply deployment on okteto Cloud'){
            steps{
                dir("Deployment") {
                    sh 'kubectl apply -f ./capstone-aerospike-kafka.yaml'
                }
            } 
        }
        stage('Kubernetes Pods status check') {
            steps{
                script{
                    statusLoop=["ViewStatus":true,"Rollback":false]
                    while(statusLoop["ViewStatus"]){
                        sh 'kubectl get pods -o wide'
                        statusLoop=input(message: 'Check radio button and perform the following action', ok: 'Submit',
                            parameters: [
                                booleanParam(name: 'ViewStatus', defaultValue: false, description: 'Check the radio button to once again view the pods status'),
                                booleanParam(name: 'Rollback', defaultValue: false, description: 'Check the radio button to rollback to previous deployment')
                            ]
                        )
                    }
                }
            }
        }
        stage('Kube Deployment Rollback'){
            when{
                expression {statusLoop["Rollback"]==true}
            }
            steps{
                echo "Need to check for the rollback command"
            }
        }
    }
}